const drawLine=function(t,o,n,s){const e=n.getContext("2d");e.strokeStyle=void 0!==s&&null!==s&&""!==s?s:"#ffffff",e.lineWidth=3,e.beginPath();e.moveTo(t.x+-80,t.y-136),e.lineTo(o.x+-80,o.y-136),e.stroke(),e.closePath()};function drawConnections(){const t=document.getElementById("canvas_connections"),o=document.getElementsByTagName("body")[0].scrollWidth,n=document.getElementsByTagName("body")[0].scrollHeight+500;t.getContext("2d").clearRect(0,0,o,n);for(const o of $(".outnodes h2").toArray())if(void 0!==$(o).attr("out_id")){const n=$(o).attr("out_id"),s=$(o).offset(),e={x:s.left+12,y:s.top+4},i=$(".connections").find('h2[con_id="'+n+'"]').toArray();try{const n={x:$(i[0]).offset().left+0,y:$(i[0]).offset().top+4};drawLine(e,n,t,$(o).parent().parent().attr("tag_color"))}catch(t){}}for(const o of $(".innodes h2").toArray())if(void 0!==$(o).attr("in_id")){const n=$(o).attr("in_id"),s=$(o).offset(),e={x:s.left+8,y:s.top},i=$(".connections").find('h2[con_id="'+n+'"]').toArray(),a={x:$(i[0]).offset().left+8,y:$(i[0]).offset().top};drawLine(e,a,t,$(o).parent().parent().attr("tag_color"))}}function setConnectionsListeners(){$(".show_outs").on("click",function(t){!function(t){const o=$(t).parent();o.toggleClass("out_expanded");let n,s=40;for(const t of o.find("h2").toArray())$(t).toggleClass("expanded"),$(t).hasClass("expanded")?($(t).css("position","relative"),n=!0):($(t).css("position","absolute"),n=!1),s+=20;o.css("height",s.toString()+"px"),n?($(t).css("background-image","url(../static/images/back_arrow.png)"),$(".add_out").css("background-color","transparent"),$(t).css("background-color","transparent"),$(t).css("margin-left","4")):($(t).css("background-image",""),$(t).css("background-color","yellow")),drawConnections()}(this)}),$(".show_ins").on("click",function(t){!function(t){const o=$(t).parent();o.toggleClass("in_expanded");let n,s=40;for(const t of o.find("h2").toArray())$(t).toggleClass("expanded"),$(t).hasClass("expanded")?($(t).css("position","relative"),n=!0):($(t).css("position","absolute"),n=!1),s+=20;o.css("width",s.toString()+"px"),n?($(t).css("background-image","url(../static/images/back_arrow.png)"),$(".add_in").css("background-color","transparent"),$(t).css("background-color","transparent"),$(t).css("margin-left","4")):($(t).css("background-image",""),$(t).css("background-color","chartreuse"),$(t).css("margin-left","0")),drawConnections()}(this)});const t=$('<div class="connections"><h2 con_id="temporal_con"></h2></div>');t.css("position","absolute"),t.css("z-index",0),t.css("visibility","hidden"),$("body").append(t),$(".add_out").on("click",function(){const o=$(this).attr("add_out_id");$(this).attr("out_id","temporal_con"),$(t).attr("parent",o),$(t).attr("type","out"),$("#canvas_connections").css("cursor","crosshair"),$(window).mousemove(function(o){t.css("top",o.pageY-36),t.css("left",o.pageX-16),drawConnections()})}),$(".add_in").on("click",function(){const o=$(this).attr("add_in_id");$(this).attr("in_id","temporal_con"),$(t).attr("parent",o),$(t).attr("type","in"),$("#canvas_connections").css("cursor","crosshair"),$(window).mousemove(function(o){t.css("top",o.pageY-36),t.css("left",o.pageX-16),drawConnections()})}),$("#canvas_connections").on("click",function(o){$(this).css("z-index",1);const n=$(t).attr("parent"),s=$(t).attr("type");$("[add_"+s+"_id="+n+"]").removeAttr(s+"_id"),$(t).removeAttr("parent"),$(t).removeAttr("type"),$(this).css("cursor","default"),drawConnections()}),$(".connections h2").on("click",function(o){const n=$(t).attr("parent"),s=$(t).attr("type"),e=$(this).attr("con_id");e!==n&&void 0!==n&&void 0!==e&&$.ajax({type:"POST",url:`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${n}/add_connection`,contentType:"application/json",data:JSON.stringify({con_id:e,type:s}),success:function(t){location.reload()}})}),$(".outnodes h2").on("click",function(t){if(void 0!==$(this).attr("out_id")&&!$(this).hasClass("add_out")){const o=$(this).attr("father"),n=$(this).attr("out_id");$(".outnode_settings").css("visibility","visible"),$(".outnode_settings").attr("nod",o),$(".outnode_settings").attr("out",n),$(".outnode_settings").attr("type","out"),$(".outnode_settings").css("top",t.pageY),$(".outnode_settings").css("left",t.pageX-20),$(".outnode_settings").css("z-index",12)}}),$(".outnode_settings").mouseleave(function(t){$(this).css("visibility","hidden")}),$(".outnode_settings h2").on("click",function(t){$(".outnode_settings").css("visibility","hidden")}),$(".innodes h2").on("click",function(t){if(void 0!==$(this).attr("in_id")&&!$(this).hasClass("add_in")){const o=$(this).attr("father"),n=$(this).attr("in_id");$(".outnode_settings").css("visibility","visible"),$(".outnode_settings").attr("nod",o),$(".outnode_settings").attr("out",n),$(".outnode_settings").attr("type","in"),$(".outnode_settings").css("top",t.pageY),$(".outnode_settings").css("left",t.pageX-20),$(".outnode_settings").css("z-index",12)}}),$("button[action=remove]").on("click",function(t){const o=$(".outnode_settings").attr("out"),n=$(".outnode_settings").attr("type"),s=$(".outnode_settings").attr("nod");$.ajax({type:"DELETE",url:`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${s}/del_connection`,contentType:"application/json",data:JSON.stringify({con_id:o,type:n}),success:function(t){location.reload()}})})}function reloadNode(t){$.ajax({url:`'${global.prot}://${global.domain}/nodes/${t}`,success:function(o){const n=$(".node_container[node_id="+t+"]");$(n).remove(),$(".container").append($(o)),setGrabbers()}})}