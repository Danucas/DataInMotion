let tmpAnPm;function newNodeFlow(s,e){$(".node_next").html(""),$(".node_back").html("");const n=function(){for(key in $("[list=headers]").empty(),s.headers){const e=$("<li></li>");$(e).attr("key",key),$(e).attr("value",s.headers[key]),$(e).text(key+":  "+s.headers[key]),$(e).on("click",function(e){const t=$(this).attr("key"),a=$(this).attr("value");$("[name=h_key] ").val(t),$("[name=h_value] ").val(a),delete s.headers[t],n()}),$("[list=headers]").append($(e))}};$(".progress li").mousemove(function(s){$(this).find("h1").css("display","block")}),$(".progress li").mouseleave(function(s){$(this).find("h1").css("display","none")});let t=0;const a="yellow",o="purple";$("[pos]").css("background-color",o),$("[pos=0]").css("background-color",a),$(".progress li").on("click",function(e){const c=$(this).attr("pos");switch($(".step").css("display","none"),$('[step="'+c+'"]').css("display","block"),t){case 0:const e=$("[name=n_name]").val();""!==e&&void 0!==e&&(s.name=e);break;case 1:const n=$("[name=is_service]").prop("checked");s.type=n?"service":"custom";break;case 2:const a=$("[name=w_type]").val();s.work_type=a;break;case 3:const o=$("[name=n_url]").val();""!==o&&(s.api_url=o);break;case 6:const i=$("[name=an_mode]").val();"none"===i?(tmpAnPm=[],s.analisis_mode="",s.analisis_params=[],$(".new_node_cont").css("display","none"),saveNode(s)):$("[mode="+i+"]").css("display","flex")}let i;switch($("[pos]").css("background-color",o),$("[pos="+c.toString()+"]").css("background-color",a),Number(c)){case 0:case 1:case 2:case 3:break;case 4:n();break;case 5:p();break;case 6:getAMInfo(i=$("[name=an_mode]").val());break;case 7:if(getAMInfo(i=$("[name=an_mode]").val()),"none"===i)return tmpAnPm=[],s.analisis_mode="",s.analisis_params=[],$(".new_node_cont").css("display","none"),saveNode(s),null;{$("[mode]").css("display","none");let e="flex";"statistics"===i&&(e="block"),$("[mode="+i+"]").css("display",e),"statistics"!==s.analisis_mode?d():r()}}$('[pos="'+c+'"]').toggleClass("actual"),$('[pos="'+t+'"]').toggleClass("actual"),t=c}),$(".li_save").on("click",function(){saveNode(s)});let c=0;tmpAnPm=s.analisis_params;const i=window.outerWidth+400,l=window.outerHeight+400;$(".new_node_cont").css("display","block"),$(".new_node_cont").css("width",i),$(".new_node_cont").css("height",l),$("[step=0]").css("display","block"),$("[step=0]").find(".node_next").on("click",function(e){const n=$("[name=n_name]").val();""!==n&&void 0!==n&&(s.name=n,$(".step").css("display","none"),$("[step=1]").css("display","block"),$("[pos=0]").css("background-color",o),$("[pos=1]").css("background-color",a),c=1)}),$("[step=0]").find(".node_back").on("click",function(s){$(".new_node_cont").css("display","none"),$("[step]").find(".node_back").unbind("click"),$("[step]").find(".node_next").unbind("click"),unbindAll(),getBoardView()}),$("[step=1]").find(".node_next").on("click",function(){const e=$("[name=is_service]").prop("checked");s.type=e?"service":"custom",$(".step").css("display","none"),$("[step=2]").css("display","block"),$("[pos=1]").css("background-color",o),$("[pos=2]").css("background-color",a)}),$("[step=1]").find(".node_back").on("click",function(s){$(".step").css("display","none"),$("[step=0]").css("display","block"),$("[pos=1]").css("background-color",o),$("[pos=0]").css("background-color",a)}),$("[step=2]").find(".node_next").on("click",function(e){const n=$("[name=w_type]").val();s.work_type=n,"request"===n?($(".step").css("display","none"),$("[step=3]").css("display","block"),$("[pos=2]").css("background-color",o),$("[pos=3]").css("background-color",a)):($(".step").css("display","none"),$("[step=5]").css("display","block"),$("[pos=2]").css("background-color",o),$("[pos=5]").css("background-color",a))}),$("[step=2]").find(".node_back").on("click",function(s){$(".step").css("display","none"),$("[step=1]").css("display","block"),$("[pos=2]").css("background-color",o),$("[pos=1]").css("background-color",a)}),$("[step=3]").find(".node_next").on("click",function(e){const t=$("[name=n_url]").val();""!==t&&(s.api_url=t,$(".step").css("display","none"),$("[step=4]").css("display","block"),$("[pos=3]").css("background-color",o),$("[pos=4]").css("background-color",a),n())}),$("[step=3]").find(".node_back").on("click",function(s){$(".step").css("display","none"),$("[step=2]").css("display","block"),$("[pos=3]").css("background-color",o),$("[pos=2]").css("background-color",a)}),$("[step=4]").find(".node_next").on("click",function(s){$(".step").css("display","none"),$("[step=5]").css("display","block"),$("[pos=4]").css("background-color",o),$("[pos=5]").css("background-color",a),p()}),$("[step=4]").find(".node_back").on("click",function(s){$(".step").css("display","none"),$("[step=3]").css("display","block"),$("[pos=4]").css("background-color",o),$("[pos=3]").css("background-color",a)}),$("[step=5]").find(".node_next").on("click",function(s){$(".step").css("display","none"),$("[step=6]").css("display","block"),$("[pos=5]").css("background-color",o),$("[pos=6]").css("background-color",a)}),$("[step=5]").find(".node_back").on("click",function(e){"request"==s.work_type?($(".step").css("display","none"),$("[step=4]").css("display","block"),$("[pos=5]").css("background-color",o),$("[pos=4]").css("background-color",a)):($(".step").css("display","none"),$("[step=2]").css("display","block"),$("[pos=5]").css("background-color",o),$("[pos=2]").css("background-color",a))}),$("[step=6]").find(".node_next").on("click",function(e){const n=$("[name=an_mode]").val();if("none"===n)return tmpAnPm=[],s.analisis_mode="",s.analisis_params=[],$(".new_node_cont").css("display","none"),$(".step").css("display","none"),saveNode(s),null;$(".step").css("display","none"),$("[step=7]").css("display","block"),$("[pos=6]").css("background-color",o),$("[pos=7]").css("background-color",a),$("[mode]").css("display","none"),$("[mode="+n+"]").css("display","flex"),"statistics"!==s.analisis_mode?d():($("[mode="+n+"]").css("display","block"),s.analisis_params===[]&&(s.analisis_params=[{parameters:{},samples:{}}]),r())}),$("[step=6]").find(".node_back").on("click",function(s){$(".step").css("display","none"),$("[step=5]").css("display","block"),$("[pos=6]").css("background-color",o),$("[pos=5]").css("background-color",a)}),$("[step=7]").find(".node_next").on("click",function(e){$(".step").css("display","none"),$(".new_node_cont").css("display","none");const n=[];for(params of tmpAnPm)null!==params&&n.push(params);return s.analisis_params=n,s.string=$("[name=string]").val(),saveNode(s),null}),$("[step=7]").find(".node_back").on("click",function(s){$(".step").css("display","none"),$("[step=6]").css("display","block")}),$("[step=4] button").on("click",function(e){const t=$("[name=h_key] ").val();let a=$("[name=h_value] ").val();""!==t&&""!==a&&(s.headers[t]=a,n(),$("[name=h_key] ").val(""),$("[name=h_value] ").val(""))}),$("[name=auth_check]").on("click",function(){$(this).prop("checked")?$(".auth_inputs").css("display","block"):$(".auth_inputs").css("display","none")}),$("[name=auth-protocol]").change(function(){});const p=function(){for(key in $("[list=data]").empty(),s.data){const e=$("<li></li>");$(e).attr("key",key),$(e).attr("value",s.data[key]),$(e).text(key+":  "+s.data[key]),$(e).on("click",function(e){const n=$(this).attr("key"),t=$(this).attr("value");$("[name=d_key] ").val(n),$("[name=d_value] ").val(t),delete s.data[n],p()}),$("[list=data]").append($(e))}};$("[step=5] button").on("click",function(){const e=$("[name=d_key] ").val();let n=$("[name=d_value] ").val();""!==e&&""!==n&&(s.data[e]=n,p(),$("[name=d_key] ").val(""),$("[name=d_value] ").val(""))}),$("[name=an_mode]").change(function(){const e=$(this).val();s.analisis_mode===e?tmpAnPm=s.analisis_params:(tmpAnPm=[],"statistics"===e&&tmpAnPm.push({parameters:{},samples:{}})),s.analisis_mode=e,$("[mode]").css("display","none"),$("[mode="+e+"]").css("display","flex"),getAMInfo(e),"statistics"!==e?d():r()});const d=function(){$("[list=params]").empty();let e=0;if(tmpAnPm.length>0)for(param of tmpAnPm){const n=$('<li pos="'+e+'"></li>');let t="";for(key in param)"discard"==key?param.discard&&(t+='<span style="font-weight: bold; color: grey;">discard occurence</span>  '):t+=param[key]+", ";$(n).html(t.slice(0,-2)),$(n).on("click",function(){const e=$(this).attr("pos");if("comparision"==s.analisis_mode)$("[name=an_d_key]").val(tmpAnPm[e].key),$("[name=cond]").val(tmpAnPm[e].cond),$("[name=comp_value]").val(tmpAnPm[e].comp);else if("replace"==s.analisis_mode)$("[name=r_key]").val(tmpAnPm[e].key);else"JSON"==s.analisis_mode?($("[name=j_key]").val(tmpAnPm[e].key),$("[name=j_path]").val(tmpAnPm[e].path)):"HTML"==s.analisis_mode&&($("[name=html_occ]").val(tmpAnPm[e].occurrence),$("[name=html_stop]").val(tmpAnPm[e].stop),$("[name=html_disc]").prop("checked",tmpAnPm[e].discard));delete tmpAnPm[e],d()}),e++,$("[list=params]").append($(n))}};$("[mode=comparision] button").on("click",function(e){const n=$("[name=an_d_key]").val(),t=$("[name=cond]").val(),a=$("[name=comp_value]").val();""!==n&&""!==t&&""!==a&&(tmpAnPm.push({key:n,cond:t,comp:a}),"statistics"!==s.analisis_mode?d():r(),$("[name=an_d_key]").val(""),$("[name=cond]").val("=="),$("[name=comp_value]").val(""))}),$("[mode=replace] button").on("click",function(e){const n=$("[name=r_key]").val(),t=$("[name=string]").val();""!==n&&""!==t&&(tmpAnPm.push({key:n}),s.string=t,d(),$("[name=r_key]").val(""))}),$("[mode=JSON] button").on("click",function(s){const e=$("[name=j_key]").val(),n=$("[name=j_path]").val();""!==e&&""!==n&&(tmpAnPm.push({key:e,path:n}),d(),$("[name=j_key]").val(""),$("[name=j_path]").val(""))}),$("[mode=HTML] button").on("click",function(s){const e=$("[name=html_occ]").val(),n=$("[name=html_disc]").prop("checked"),t=$("[name=html_stop]").val();""!==key&&""!==t&&(tmpAnPm.push({occurrence:e,stop:t,discard:n}),d(),$("[name=html_stop]").val(""),$("[name=html_occ]").val(""))}),$("[mode=gen_signature] input").change(function(s){const e=$("[name=g_key1]").val(),n=$("[name=g_key2]").val();""!==e&&""!==n&&((tmpAnPm=[]).push(e),tmpAnPm.push(n))}),$("[mode=get_updates] button").on("click",function(s){const e=$("[name=upd_key]").val(),n=$("[name=upd_path]").val();""!==e&&""!==n&&(tmpAnPm.push({key:e,path:n}),d(),$("[name=upd_key]").val(""),$("[name=upd_path]").val(""))});const r=function(){const s=$("[list=statistics_samples]"),e=$("[list=statistics_parameters]");$(s).empty(),$(e).empty();const n=$("<h1>Samples</h1>"),t=$("<h1>Parameters</h1>");$(s).append(n),$(e).append(t);const a=function(s){const e=$(s).attr("type"),n=$(s).attr("key");tmpAnPm[0][e][n];delete tmpAnPm[0][e][n],r(),$("[name="+e+"]").val(n)};for(sample in tmpAnPm[0].samples){const e=$("<li></li>");$(e).text(sample),$(e).attr("type","samples"),$(e).attr("key",sample),$(e).on("click",function(s){a(this)}),$(s).append($(e))}for(parameter in tmpAnPm[0].parameters){const s=$("<li></li>");$(s).attr("type","parameters"),$(s).attr("key",parameter),$(s).text(parameter),$(s).on("click",function(s){a(this)}),$(e).append($(s))}};$('[mode=statistics] button[for="parameters"]').on("click",function(s){const e=$("[name=parameters]").val();""!==e&&(tmpAnPm[0].parameters[e]=!0,$("[name=parameters]").val(""),r())}),$('[mode=statistics] button[for="samples"]').on("click",function(s){const e=$("[name=samples]").val();""!==e&&(tmpAnPm[0].samples[e]=!0,$("[name=samples]").val(""),r())}),$("[mode=list_ops] button").on("click",function(s){const e=$('[name="list_ops_key"]').val(),n=$('[name="list_ops_value"]').val(),t=$('[name="list_opt_sign"]').children("option:selected").val();""!==e&&""!==n&&""!==t&&(tmpAnPm.push({list:e,value:n,opt:t}),d(),$("[name=list_ops_key]").val(""),$("[name=list_ops_value]").val(""))}),p()}function getAMInfo(s){let e;"comparision"==s?e="Compares a list of values and returns to you a true or false value":"JSON"==s?e='Extracts the value at the given path from the data and store it with the name you define, in the path you can define the keyword "random" to choose a random index in a list':"HTML"==s?e='Scrappe an HTML or a text file to find the occurrencies and extract the values until the stop value and store it as you want to name it<br>You can use wildcards "*" to extract values from the previous nodes and put them in the occurrence pattern<br>Example: my_url = sponges<br>href="some/url/*my_url*<br> Result -> some/url/sponges':"replace"==s?e='Finds the {getBoardskey} formats and replace them with the correspoding data value, the keys are a cumulative of all the output, lom that means, you can find a value of a node much further back in the flow<br>And the output of this node will be stored with the key "content" to be used in the forward of the flow<br>Run a test and check the output for the keys you need':"gen_signature"==s?e="Uses the headers from the connection node and the keys stored in the data to create a HMAC-SHA1 signature":"none"==s?e="":"media_player"==s?e='when this option is selected, the caller node should pass a value with the key "url" in order to load the source file, if you connect this node with a download node, we will handle the media for you':"get_updates"==s?e='set the key to store the extracted data, and the path to get the value<br>this options finds if there is new records in the input data and extract the last one by checking the parameter counter stored in the node to use this option set the value "count" to 0 or whatever value you need in the previous section':"statistics"==s&&(e="samples:<br>parameters:<br>"),$("[content=analisis_mode]").html(e),$("[content=analisis_info]").html(e)}function saveNode(s){const e=$("[name=n_name]").val();""!==e&&void 0!==e&&(s.name=e);const n=$("[name=n_url]").val();""!==n&&(s.api_url=n);const t=[];for(params of tmpAnPm)null!==params&&t.push(params);s.analisis_params=t;const a=$("[name=w_type]").val();s.work_type=a,s.string=$("[name=string]").val(),$.ajax({url:`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${s.id}/save`,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(s),success:function(s){unbindAll(),getBoardView(),$(".new_node_cont").css("display","none")}})}async function loadContactList(s){const e=await fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${s}`);return await e.json()}async function loadContactsNodes(){const s=$(".container").attr("board_id"),e=await fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/${s}/contacts_list`);return await e.json()}async function WhatsAppFlow(s,e){const n="#00bfa5";s.data.gif;const t=function(){const s=$('[contacts="true"] ul');for(cont in $(s).empty(),c){const e=$(`<li>${cont}</li>`);$(e).on("click",function(){const s=$('[name="contact_name"]'),e=$('[name="contact_number"]'),n=c[$(this).text()];s.val($(this).text()),e.val(n),delete c[$(this).text()],t()}),$(s).append($(e))}},a=function(){void 0!==o?$('[contacts="true"] label').text(`Contacts in ${o.name}:`):$('[contacts="true"] label').text("New Contacts List"),$(".contacts_lists").css("display","none"),$('[contacts="true"]').css("display","block"),$('[select="contacts"]').css("display","none"),$('[show="true"]').text("List options"),$('[show="true"]').addClass("list_opts"),$('[show="true"]').on("click",function(s){$(this).removeClass("list_opts"),$(this).text("Select an option:"),$('[select="contacts"]').css("display","block"),$('[contacts="true"]').css("display","none"),$('[edit="true"]').css("display","block"),$('[edit="true"]').on("click",function(s){a()})}),t()};let o,c={};s.innodes.length>0&&(c=s.innodes,o=await loadContactList(c[0]),c=o.data,a());const i=document.querySelector('[id="csv"]');i.addEventListener("change",function(){const s=this.files,e=new FileReader;e.onload=function(s){let e=s.target.result;e=e.split("\n").slice(1,e.length);for(const s of e){const e=s.split(",")[0],n=s.split(",")[1];c[e]=n}a()},e.readAsText(s[0])}),document.querySelector(".csv-upload").addEventListener("click",function(){i.click()});const l=$('div[form="whatsapp_node"]');$(".wpp_cont").css("display","block"),$(l).css("left",e.pageX-100),$(l).css("top",e.pageY-180),l.css("display","block"),""!==s.data.gif&&($('[name="giphy"]').val(s.data.gif),$('[name="giphy"]').css("display","block"),$('[select="gif"] h2').css("background-color","white"),$('[select="gif"] h2').css("color",n)),$('[close="whatsapp"]').on("click",function(s){l.css("display","none"),$(".wpp_cont").css("display","none"),unbindAll(),getBoardView()}),$('[name="wpp_admin"]').val(s.data.admin),$('[name="wpp_admin"]').keypress(function(e){s.data.admin=$(this).val()}),$('[select="gif"] h2').on("click",function(){"none"===$('[name="giphy"]').css("display")?($('[name="giphy"]').css("display","block"),$(this).css("background-color","white"),$(this).css("color",n)):($('[name="giphy"]').css("display","none"),$('[name="giphy"]').val(""),$(this).css("background-color",n),$(this).css("color","white"),s.data.gif="")}),$('[name="giphy"]').keypress(function(e){s.data.gif=$(this).val()+e.key}),$('[create="true"]').on("click",function(s){c={},o=void 0,a()}),$('[connect="true"]').on("click",async function(s){lists=await loadContactsNodes(),$(".contacts_lists").css("display","block");const e=$(".contacts_lists ul");for(list of($(e).empty(),lists)){const s=$(`<li contacts_id="${list.id}">${list.name}</li>`);$(s).on("click",function(s){for(lis of lists)lis.id===$(this).attr("contacts_id")&&(c=lis.data,o=lis,a())}),$(e).append($(s))}}),$('[contacts="true"] button').on("click",function(s){const e=$('[name="contact_name"]'),n=$('[name="contact_number"]');""!==e.val()&&""!==n.val()&&(c[e.val()]=n.val(),e.val(""),n.val(""),t())}),$('[save="whatsapp"]').on("click",function(e){s.data.test=$('[id="twilio"]').is(":checked"),s.data.admin=$('[name="wpp_admin"]').val(),saveWhatsappNode(s,o,c)})}async function saveWhatsappNode(s,e,n){let t=e;if(void 0!==t){s.innodes=[t.id],t.data=n;const e=await fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${t.id}/save`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:localStorage.getItem("token")},body:JSON.stringify(t)});await e.json()}else{const e=$(".container").attr("board_id"),a=await fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/${e}/create_node`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:localStorage.getItem("token")},body:JSON.stringify({data:n,type:"contacts_list"})});t=await a.json(),s.innodes=[t.id]}const a=await fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${s.id}/save`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:localStorage.getItem("token")},body:JSON.stringify(s)});await a.json();$(".wpp_cont").css("display","none"),unbindAll(),getBoardView()}