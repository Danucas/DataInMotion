let trackedBoard,board={};function createMenu(o,e){const t=$(".menus");t.css("visibility","visible"),t.css("left",o-40);for(const o of e){let e="";e+="<li>"+o[0]+"</li>";const n=$(e);n.on("click",o[1]),t.append(n)}t.mouseleave(function(){$(this).css("visibility","hidden")})}const initial={};let topColor,importedBoard;function drawDashboard(o){const e=$("<div></div>");$(e).addClass("boards"),$(e).css("margin-top","40px");let t=1;const n=$("<div><h1>add a new Board</h1></div>");for(board of($(n).addClass("add_board"),$(n).css("background-image","url(/static/images/plus.png)"),$(n).hover(function(){$(this).css("box-shadow","0px 0px 30px #ffffffa1")},function(){$(this).css("box-shadow","0px 0px 0px white")}),$(e).append($(n)),o)){const o=$("<h1></h1>");null===board.name?o.text("Board"+t):o.text(board.name),t++;const n=$("<h2></h2>");n.text(board.id);const s=$("<div></div>");s.append(o),s.append(n),$(s).attr("b_id",board.id),$(s).addClass("gradient"),$(s).hover(function(){$(this).css("box-shadow","0px 0px 30px #ffffffa1")},function(){$(this).css("box-shadow","0px 0px 0px white")}),e.append(s)}$("body").append($(e)),$(".boards > div").on("mousedown",function(){trackedBoard=$(this).attr("b_id"),initial.x=$(this).position().left,initial.y=$(this).position().top,topColor=$(".top_bar").css("background-color"),$(window).mousemove(function(o){const e=$("[b_id="+trackedBoard+"]");$(e).css("position","absolute"),$(e).css("z-index","30"),$(e).css("left",(o.pageX-200).toString()),$(e).css("top",(o.pageY-200).toString()),o.pageY<100?($(".top_bar").css("background-color","#e7cee1"),$(".delete_sign").css("display","block"),$(".grab_message").css("display","none")):($(".top_bar").css("background-color",topColor),$(".delete_sign").css("display","none"),$(".grab_message").css("display","block"))})}),$(".boards > div").on("mouseup",function(){$(window).unbind("mousemove");const o=$(this).position().top;if($(this).attr("b_id")===trackedBoard)if(o<-97){trackedBoard="",confirm("You are about to delete this board?\nThis can't be undone\nContinue")?fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/`+$(this).attr("b_id")+"/delete").then(function(o){location.reload()}):($(this).css("position","relative"),$(this).css("top","0"),$(this).css("left","0"),$(".top_bar").css("background-color",topColor),$(".delete_sign").css("display","none"),$(".grab_message").css("display","block"),$(board).css("z-index","10"))}else if(initial.x===$(this).position().left&&initial.y===$(this).position().top){void 0!==$(this).attr("b_id")?window.open("/boards/"+$(this).attr("b_id"),"_self"):createBoard()}else $(this).css("position","relative"),$(this).css("top","0"),$(this).css("left","0"),$(board).css("z-index","10")})}function getBoards(){fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/users/boards`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")}}).then(o=>{if(200===o.status)return o.json();localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.replace("/login")}).then(o=>{drawDashboard(o)})}function createBoard(){fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/users/create_board`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")}}).then(o=>{if(200===o.status)return o.json();window.location.replace("/login")}).then(o=>{window.open("/boards/"+o.board_id,"_self")})}function saveBoardName(o){const e=$(".container").attr("board_id");$.ajax({type:"POST",url:`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/${e}/save_name`,dataType:"json",contentType:"application/json",data:JSON.stringify({name:o}),success:function(o){saving=!1}})}function setNodeView(o,e){unbinNodeEditor(),$("[name=n_name]").val(o.name),"service"===o.type?$("[name=is_service]").prop("checked",!0):$("[name=is_service]").prop("checked",!1),$("[name=w_type]").val(o.work_type),$("[name=n_url]").val(o.api_url),$("[name=an_mode]").val(o.analisis_mode),$("[name=string]").val(o.string),$(".node_cont_info").css("top",e.pageY+20),$(".node_cont_info").css("left",e.pageX-30),$(".progress").css("top",e.pageY-26),$(".progress").css("left",e.pageX+80),$(".close_node").css("top",e.pageY),$(".close_node").css("left",e.pageX-30),$(".close_node").on("click",function(){o=null,$(".new_node_cont").css("display","none"),unbindAll(),getBoardView()}),$(".step").css("display","none"),newNodeFlow(o,o.id)}function newNode(o){const e=$(".container").attr("board_id");$.ajax({url:`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/${e}/create_node`,type:"POST",contentType:"application/json",data:JSON.stringify({type:o}),success:function(o){if("sender"===o.work_type)WhatsAppFlow(o,{pageX:140,pageY:200});else{$(".new_node_cont").css("display","block");const e=document.getElementById("node_editor");new NodeEditor(e,o.id).setpos({pageX:40,pageY:200})}},error:function(o){}})}function importTheNode(o,e){const t=$(".container").attr("board_id");fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${o}/copy_to/${t}`).then(function(o){return o}).then(function(o){$(".import").css("display","none"),e&&location.reload()})}function importTheNodeOnByOne(o){const e=$(".container").attr("board_id");fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/${e}/add_node`,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(function(o){return o}).then(function(o){$(".import").css("display","none"),location.reload()})}function importCompleteBoard(o){const e=$(".container").attr("board_id");fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/${e}/complete_board`,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(function(o){return o}).then(function(o){$(".import").css("display","none"),location.reload()})}function importNode(){$(".import").css("display","block"),$(".import").css("z-index","20");const o=$(".container").attr("board_id");fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/users/${o}/boards_nodes`).then(function(o){return o.json()}).then(function(o){const e=$('<div class="board_nodes"></div>');for(board in o){const t=$('<div class="board_node"></div>');for(node in $(t).append($(`<h1>${o[board].name}</h1>`)),o[board].nodes){const e=o[board].nodes[node].name,n=o[board].nodes[node].id,s=$(`<h2 node_id="${n}">${e}</h2>`);$(s).on("click",function(o){importTheNode($(this).attr("node_id"),!0)}),t.append(s)}e.append(t)}const t=Object.keys(o).length;if(Math.round(t/3)>0){const o=Math.round(t/3)-1;let e=$(".board_nodes").css("grid-template-rows");for(let t=0;t<o;t++)e+="130px";$(".board_nodes").css("grid-template-rows",e)}$(".import").empty(),$(".import").append($("<h3></h3>")),$(".import h3").on("click",function(o){$(".import").css("display","none")}),$(".import").append(e),$(".import").css("z-index",30),$(".import").css("display","block")})}function importBoard(){const o=$('<div class="file_cont"></div>'),e=$('<div class="alert_cont"></div>'),t=$('<h2 class="close"></h2>'),n=$('<input id="file" name="file" type="file" accept=".dim" style="display: none;">'),s=$('<input class="browse" type="button" value="Browse from device...">'),i=$("<button >import complete board</button>"),a=$("<button >import one or more nodes</button>");$(s).on("click",function(){$(n).trigger("click")}),$(n).change(function(e){const t=new FileReader;t.onload=function(e){importedBoard=JSON.parse(e.target.result),$(o).append($(a)),$(o).append($(i)),$(o).append($(`<div class="import_name"><h1>${importedBoard.data.name}</h1><button>import</button></div>`))},t.readAsText(e.target.files[0])}),$(a).on("click",function(e){const t=$('<ul style="margin: 0;padding: 0;"></ul>');for(node in importedBoard.nodes){const o=importedBoard.nodes[node].name,e=$(`<li node_id="${node}"></li>`),n=$(`<h3>${o}</h3><input type="checkbox" style="margin-top: 6px;">`);$(e).append($(n)),$(t).append($(e))}$(".import_name button").css("display","block"),$(".import_name button").on("click",function(o){const e=$(this).parent().parent().find("ul")[0],t=$(e).children().toArray(),n=[];for(li of t){const o=$(li).find("input"),e=($(li).find("h3").text(),$(li).attr("node_id"));$(o).prop("checked")&&n.push(importedBoard.nodes[e])}importTheNodeOnByOne(n)}),$(o).append($(t))}),$(i).on("click",function(){importCompleteBoard(importedBoard)}),$(t).on("click",function(){$(e).remove()}),$(o).append($(n)),$(o).append($(s)),$(o).append($(t)),$(e).append($(o)),$("body").append($(e)),$(e).css("display","block")}function exportBoard(){const o=$('<div class="alert_cont" ></div>'),e=$('<h2 class="close"></h2>'),t=$('<div class="file_cont" style="width: auto;"></div>'),n=$('<a id="download_board" class="download_board">Download this board</a>'),s={data:board},i=$(".container").attr("board_id"),a=$(".board_name").text().replace(/^\s+|\s+$/g,"");$(e).on("click",function(){$(o).remove()}),fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/${i}/nodes`).then(function(o){return o.json()}).then(function(i){s.nodes=i;const d="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(s));$(n).on("click",function(e){$(o).remove()}),$(n).attr("href",d),$(n).attr("download",`${a}.dim`),$(t).append($(n)),$(t).append($(e)),$(o).append($(t)),$("body").append($(o))})}function deleteNode(o){$.ajax({type:"DELETE",url:`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${o}`,success:function(e){$("[node_id="+o+"]").remove(),unbindAll(),getBoardView()},error:function(o){}})}function setProjectMenu(){$("[menu=project]").on("click",function(o){$(".menus").empty();const e=[];e.push(["create new board",createBoard]),createMenu(o.pageX,e)}),$("[menu=nodes]").mousemove(function(){$(this).find("i").addClass("menu-nodes-hover")}),$("[menu=nodes]").mouseleave(function(){$(this).find("i").removeClass("menu-nodes-hover")}),$("[menu=nodes]").on("click",function(o){$(".menus").empty();createNodesMenu(o.pageX,[{title:"Data",description:"This nodes are used to fetch or post data to any source",options:{custom:"Select an empty request",StarWars:"load the predefined StarWars"}},{title:"Process and Analysis",description:"Choose how to process the Data, this allows you to extract and transform the values as you need to get the desired insights",options:{comparision:"Compare values or determine if a value contains another one",HTML:"Web scrapping, extract values from HTML plain text",JSON:"Extracts values from the Data and store them with a custom key",media_player:"Visualizes the Data in formats image/png, jpg, gif"}},{title:"Content creation",description:"Create customizable messages using the Data (before or After processing, depends on how you connect the nodes)",options:{new_message:"empty message"}},{title:"Social Media Channels",description:"Choose where to share your Content",options:{contacts_list:"A distribution list to send the Content",whatsapp_text:"Send text messages to a selected contacts list",whatsapp_text_gif:"Send gif and text message to a selected contacts list",whatsapp_gif:"Send gif media to a selected contacts list",twitter_text:"Send text update to Twitter",twitter_gif:"(cluster) Upload and post a media file to Twitter ",twitter_text_gif:"(cluster) Upload and post a media file and a customized message to Twitter"}}])}),$("[menu=board]").mousemove(function(){$(this).find("i").addClass("menu-board-hover")}),$("[menu=board]").mouseleave(function(){$(this).find("i").removeClass("menu-board-hover")}),$("[menu=board]").on("click",function(o){$(".menus").empty();const e=[];e.push(["import file",importBoard]),e.push(["export file",exportBoard]),createMenu(o.pageX,e)}),$("[menu=users]").mousemove(function(){$(this).find("i").addClass("menu-users-hover")}),$("[menu=users]").mouseleave(function(){$(this).find("i").removeClass("menu-users-hover")}),$("[menu=users]").on("click",function(){$(".add_user").css("display","block"),$('[close="true"]').on("click",function(){$(".add_user").css("display","none")}),$('[add="true"]').on("click",function(){$('[name="new_user"]').val()&&fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/boards/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")},body:JSON.stringify({email:$('[name="new_user"]').val(),board:$(".container").attr("board_id")})}).then(o=>o.json()).then(o=>{$(".add_user").css("display","none")})})})}function createNodesMenu(o,e){const t=$(".menus"),n=$(t).css("background-color");t.css("visibility","visible"),t.css("left",o-40),t.css("padding-top","40px"),t.css("background-color","white");const s=$('<div class="node_desc"></div>');$(t).append($(s));const i=$('<h2 import="true" desc="import from other boards">import_from_board</h2>');$(i).css("cursor","pointer"),$(i).css("margin-left","20px"),$(i).css("font-size","16px"),$(i).css("border","1px solid black"),$(i).css("border-radius","12px"),$(i).css("width","200px"),$(i).css("padding","4px 16px"),$(i).css("text-align","center"),$(i).on("mousemove",function(o){$(i).css("background-color","grey"),$(i).css("color","white")}),$(i).on("mouseleave",function(){$(this).css("background-color","white"),$(this).css("color","grey")}),$(i).on("click",function(o){t.css("visibility","hidden"),importNode()}),$(t).append($(i));for(const o of e){let e="";e+=`<div class="category"><div class="nodes_info"><h3>${o.title}</h3><h1>${o.description}</h1></div>`;const n=$(e),s=$('<div class="options_container"></div>');for(option in o.options){const e=$(`<h2 desc="${o.options[option]}">${option}</h2>`);$(e).on("click",function(o){newNode($(this).text())}),$(e).on("mousemove",function(o){const e=$(this).attr("desc");$(".node_desc").css("display","block"),$(".node_desc").text(`${$(this).text()}: ${e}`),$(".node_desc").css("top",$(this).position().top-$(".node_desc").outerHeight()-10+$(t).scrollTop())}),$(e).on("mouseleave",function(o){$(this).attr("desc");$(".node_desc").css("display","none")}),$(s).append($(e))}$(n).append($(s)),$(t).append($(n))}$(t).mouseleave(function(){$(this).css("visibility","hidden"),t.css("background-color",n),t.css("padding-top","0")})}function createNewNode(o){}