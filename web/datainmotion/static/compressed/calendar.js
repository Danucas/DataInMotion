function monthToText(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][e]}function getDaysInMonth(e,t){return new Date(t,e+1,0).getDate()}class Calendar{constructor(e,t,a){this._nodeId=t,this._date=e,this.root=a}set context(e){this._context=e}async build(e,t){const a=await fetch(`${global.prot}://${global.domain}/calendar`),n=await a.text();let o=(new DOMParser).parseFromString(n,"text/html");(o=o.body.firstChild).style.left=e+"px",o.style.top=t+"px",this.root.appendChild(o),o.querySelector('[nav="prev"]').addEventListener("click",function(){0==r._date[1]?(r._date[1]=11,r._date[0]=r._date[0]-1):r._date[1]=r._date[1]-1,r.draw()});const r=this;r._date[5]=0,o.querySelector('[nav="next"]').addEventListener("click",function(){11==r._date[1]?(r._date[1]=0,r._date[0]=r._date[0]+1):r._date[1]=r._date[1]+1,r.draw()}),o.querySelector('[name="hour"]').addEventListener("change",function(e){const t=Number(e.target.options[e.target.selectedIndex].value);e.target.text=t,r._date[3]=t}),o.querySelector('[name="minute"]').addEventListener("change",function(e){r._date[4]=Number(e.target.options[e.target.selectedIndex].value),e.target.text=r._date[4]}),o.querySelector('[save="calendar"]').addEventListener("click",function(e){r.save()}),this._html=o,this.draw()}draw(){this._html.querySelector(".calendar_head h1").innerHTML=monthToText(this._date[1])+" - "+this._date[0];const e=getDaysInMonth(this._date[1],this._date[0]),t=new Date(this._date[0],this._date[1],1).getDay(),a=Array.from({length:e+t},e=>0),n=this._html.querySelector(".days_selector");n.innerHTML="";const o=this;o._date[5]=0;const r=getComputedStyle(document.documentElement).getPropertyValue("--active"),d=getComputedStyle(document.documentElement).getPropertyValue("--unselected"),c=getComputedStyle(document.documentElement).getPropertyValue("--today");function s(e){const t=Number(e.target.getAttribute("day")),a=document.querySelector(`[day="${o._date[2]}"`);try{a.style.backgroundColor="white",a.style.color=d}catch(e){}o._date[2]=Number(t),e.target.style.backgroundColor=r,e.target.style.color="white";const n=new Date(Date.now());if(n.getDate()!==t&&n.getMonth()===o._date[1]){const e=document.querySelector(`[day="${n.getDate()}"`);e.style.backgroundColor=c,e.style.color="white"}}const l=document.querySelectorAll(".days_selector li");for(const e of l)e.removeEventListener("click",s);for(let e=0,o=1-t;e<a.length;e++,o++){const e=document.createElement("li");o>0&&(e.setAttribute("day",o),e.className="day",e.innerHTML=o,e.addEventListener("click",s)),n.appendChild(e)}const i=new Date(Date.now());if(i.getDate()!==o._date[2]&&i.getMonth()===o._date[1]){const e=document.querySelector(`[day="${new Date(Date.now()).getDate()}"`);e.style.backgroundColor=c,e.style.color="white"}const u=document.querySelector(`[day="${o._date[2]}"`);try{u.style.backgroundColor=r,u.style.color="white"}catch(e){}const h=document.querySelector('[name="hour"]'),m=document.querySelector('[name="noon"]');this._date[3]>12?(h.value=this._date[3]-12,m.value=1):(h.value=this._date[3],m.value=0),document.querySelector('[name="minute"]').value=this._date[4]}async save(){const e=this,t=e._html.querySelector('[name="hour"]');e._date[3]=Number(t.options[t.selectedIndex].value);const a=e._html.querySelector('[name="minute"]');e._date[4]=Number(a.options[a.selectedIndex].value);const n=e._html.querySelector('[name="noon"]'),o=Number(n.options[n.selectedIndex].value);1==o&&(12==e._date[3]?e._date[3]=0:e._date[3]=e._date[3]+12),e._date[1]+=1;await e.sendDate();if(e._html.remove(),this._context){const t=e._date.map(e=>Array.isArray(e)?e.clone():e);t[1]-=1,this._context.data.analisis_params.date=e._date,this._context.printFormatedDate(this._context.triggerDateContainer,t)}}async sendDate(){const e=new Date(Date.now()),t=await fetch(`${global.prot}://${global.domain}${global.apiPort}/api/v1/nodes/${this._nodeId}/save`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:localStorage.getItem("token")},body:JSON.stringify({type:"service",analisis_params:{date:this._date,sync_date:[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}})});return await t.json()}close(){this._html.remove()}}